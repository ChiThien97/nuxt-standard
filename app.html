<!DOCTYPE html>
<html {{ HTML_ATTRS }}>
<head {{ HEAD_ATTRS }}>
  {{ HEAD }}
</head>
<body {{ BODY_ATTRS }}>
{{ APP }}
</body>
<script defer>
  window.addEventListener('DOMContentLoaded', (event) => {
    setTimeout(() => {
      !function (e, t, a, n, g) {
        e[n] = e[n] || [], e[n].push({'gtm.start': (new Date).getTime(), event: 'gtm.js'})
        var m = t.getElementsByTagName(a)[0], r = t.createElement(a)
        r.async = !0, r.src = 'https://www.googletagmanager.com/gtm.js?id=GTM-M4CLPV', m.parentNode.insertBefore(r, m)
      }(window, document, 'script', 'dataLayer')

      function getCookie(cname) {
        let name = cname + '='
        let decodedCookie = decodeURIComponent(document.cookie)
        let ca = decodedCookie.split(';')
        for (let i = 0; i < ca.length; i++) {
          let c = ca[i]
          while (c.charAt(0) == ' ') {
            c = c.substring(1)
          }
          if (c.indexOf(name) == 0) {
            return c.substring(name.length, c.length)
          }
        }
        return ''
      }

      const user = getCookie('user') ? JSON.parse(getCookie('user')) : null
      const userPhone = user && user.phone ? user.phone : ''
      window.o2oDigitalData = [{
        trackingId: 'UA-7397805-18',
        fbPixelId: '268693807341026',
        internalUid: userPhone
      }];

      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
          m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-7397805-11', 'auto');
      ga('send', 'pageview');

      (function (w, d, s, l, i) {
        w[l] = w[l] || []
        w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'})
        var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''
        j.async = true
        j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl
        f.parentNode.insertBefore(j, f)
      })(window, document, 'script', 'o2oDigitalData', 'GTM-5D9BSSG')

      //insider
      if(userPhone){
        const phoneNumber =  (userPhone.match(/(^(0|84))\d+/)) ? userPhone.replace(/^(0|84)/, '+84') : userPhone
        window.insider_object = {
          "user":{
            "uuid": userPhone,
            "name": user.name,
            "phone_number": phoneNumber,
            "sms_optin": true,
          }
        }
        if(user.email){
          window.insider_object.user.email = user.email
          window.insider_object.user.email_optin = true
        }
      }
    }, 3000)


    setTimeout(() => {
      var _i = document.createElement('script'),
        _s = document.scripts[0];
      _i.defer = true;
      _i.src = '//www.google.com/recaptcha/api.js?onload=vueRecaptchaApiLoaded&render=explicit';
      _s.parentNode.insertBefore(_i, _s);
    }, 5000)
  });



</script>

</html>
